<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .copy-btn {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container my-4">
    <h1><%= course.courseName %></h1>
    <p><%= course.courseDescription %></p>
    
    <div class="mb-3">
      <span class="fw-bold">Course ID:</span>
      <span id="courseId" class="text-monospace copy-btn"><%= course._id %></span>
      <button id="copyBtn" class="btn btn-outline-secondary btn-sm">Copy</button>
    </div>
    
    <% if (course.subjects && course.subjects.length > 0) { %>
      <div class="accordion" id="accordion-<%= course._id %>">
        <% course.subjects.forEach((subject, index) => { %>
          <div class="accordion-item">
            <h2 class="accordion-header" id="heading-<%= course._id %>-<%= index %>">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#collapse-<%= course._id %>-<%= index %>" aria-expanded="false"
                aria-controls="collapse-<%= course._id %>-<%= index %>">
                <%= subject.subjectName %>
              </button>
            </h2>
            <div id="collapse-<%= course._id %>-<%= index %>" class="accordion-collapse collapse"
              aria-labelledby="heading-<%= course._id %>-<%= index %>" data-bs-parent="#accordion-<%= course._id %>">
              <div class="accordion-body">
                <div class="accordion-header" id="heading-chapters-<%= subject._id %>">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapse-chapters-<%= subject._id %>" aria-expanded="false"
                    aria-controls="collapse-chapters-<%= subject._id %>">
                    Chapters
                  </button>
                </div>
                <div id="collapse-chapters-<%= subject._id %>" class="accordion-collapse collapse">
                  <ul class="list-group list-group-flush">
                    <% subject.chapters.forEach((chapter, chapterIndex) => { %>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span>
                          Chapter <%= chapter.chapterNumber %>: <%= chapter.chapterName %>
                        </span>
                        <% if (chapter.screenRecordingLink) { %>
                          <a href="/viewclass/<%= course._id %>/<%= subject._id %>/<%= chapter._id %>" class="btn btn-sm btn-success">
                            View Class
                          </a>
                        <% } else { %>
                          <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button"
                              id="dropdownMenuButton-<%= chapter._id %>" data-bs-toggle="dropdown"
                              aria-expanded="false">
                              Options
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton-<%= chapter._id %>">
                              <li>
                                <a class="dropdown-item"
                                  href="/examiner/<%= course._id %>/<%= subject._id %>/<%= chapter._id %>/record">
                                  Record Video
                                </a>
                              </li>
                              <li>
                                <a class="dropdown-item" href="/examiner/<%= course._id %>/<%= subject._id %>/<%= chapter._id %>/live">
                                  Go Live
                                </a>
                              </li>
                            </ul>
                          </div>
                        <% } %>
                      </li>
                    <% }) %>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <p class="text-muted mt-3">No subjects added yet</p>
    <% } %>
    
    <div class="card-footer bg-transparent mt-3">
      <small class="text-muted">
        Created: <%= new Date(course.createdAt).toLocaleDateString() %>
      </small>
    </div>
  </div>

  
  <script>
    // When the copy button is clicked, copy the Course ID to clipboard
    document.getElementById('copyBtn').addEventListener('click', function() {
      var courseId = document.getElementById('courseId').innerText;
      navigator.clipboard.writeText(courseId).then(function() {
        alert('Course ID copied to clipboard!');
      }, function(err) {
        console.error('Failed to copy text: ', err);
      });
    });
  </script>
</body>
</html>
